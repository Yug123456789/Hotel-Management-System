{% extends 'partials/hotel-user.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/roombookingdisplay.css' %}">

<div class="container booking-container my-4">
    <h2 class="booking-header">Your Room Bookings</h2>
    
    <div class="filter-section">
        <form method="get">
            <label for="hotel_id" class="filter-label">Filter by Hotel:</label>
            <select name="hotel_id" id="hotel_id" class="hotel-select" onchange="this.form.submit()">
                
                {% for hotel in hotels %}
                    <option value="{{ hotel.id }}" {% if hotel.id|stringformat:"s" == selected_hotel_id %}selected{% endif %}>
                        {{ hotel.name }}
                    </option>
                {% endfor %}
            </select>
        </form>
    </div>
    
    {% if bookings %}
        <div class="table-responsive">
            <table class="table bookings-table">
                <thead>
                    <tr>
                        <th class="col-id">Booking ID</th>
                        <th class="col-hotel">Hotel</th>
                        <th class="col-room">Room Type</th>
                        <th class="col-payment">Payment Status</th>
                        <th class="col-total">Total</th>
                        <th class="col-fullname">Full Name</th>
                        <th class="col-email">Email</th>
                        <th class="col-coupons">Coupons Used</th>
                        <th class="col-checkin">Check In</th>
                        <th class="col-checkout">Check Out</th>
                    </tr>
                </thead>
                <tbody>
                    {% for booking in bookings %}
                    <tr>
                        <td class="booking-id">{{ booking.booking_id }}</td>
                        <td class="hotel-name">{{ booking.hotel.name }}</td>
                        <td class="room-type">{{ booking.room_type }}</td>
                        <td class="{% if booking.payment_status == 'Completed' %}payment-complete{% else %}payment-pending{% endif %}">
                            {{ booking.payment_status|default:"-" }}
                        </td>
                        <td class="price">Rs.{{ booking.total }}</td>
                        <td class="full-name">{{ booking.full_name }}</td>
                        <td class="email">{{ booking.email }}</td>
                        <td>
                            {% for coupon in booking.coupons.all %}
                                <span class="coupon-badge">{{ coupon.code }}</span>
                            {% empty %}
                                <span class="text-muted">None</span>
                            {% endfor %}
                        </td>
                        <td class="date-info">{{ booking.check_in_date }}</td>
                        <td class="date-info">{{ booking.check_out_date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
        </div>
    {% else %}
        <div class="no-bookings">You have no bookings yet.</div>
    {% endif %}
</div>

<script>
    // Ensure filter is always visible even with no bookings
    document.addEventListener('DOMContentLoaded', function() {
        // Script remains the same - filter section is outside the conditional block
    });
</script>
{% endblock content %}